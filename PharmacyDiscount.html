<html lang="en" class=" sizes customelements history pointerevents postmessage webgl websockets cssanimations csscolumns csscolumns-width csscolumns-span csscolumns-fill csscolumns-gap csscolumns-rule csscolumns-rulecolor csscolumns-rulestyle csscolumns-rulewidth csscolumns-breakbefore csscolumns-breakafter csscolumns-breakinside flexbox picture srcset webworkers sizes customelements history pointerevents postmessage webgl websockets cssanimations csscolumns csscolumns-width csscolumns-span csscolumns-fill csscolumns-gap csscolumns-rule csscolumns-rulecolor csscolumns-rulestyle csscolumns-rulewidth csscolumns-breakbefore csscolumns-breakafter csscolumns-breakinside flexbox picture srcset webworkers sizes customelements history pointerevents postmessage webgl websockets cssanimations csscolumns csscolumns-width csscolumns-span csscolumns-fill csscolumns-gap csscolumns-rule csscolumns-rulecolor csscolumns-rulestyle csscolumns-rulewidth csscolumns-breakbefore csscolumns-breakafter csscolumns-breakinside flexbox picture srcset webworkers sizes customelements history pointerevents postmessage webgl websockets cssanimations csscolumns csscolumns-width csscolumns-span csscolumns-fill csscolumns-gap csscolumns-rule csscolumns-rulecolor csscolumns-rulestyle csscolumns-rulewidth csscolumns-breakbefore csscolumns-breakafter csscolumns-breakinside flexbox picture srcset webworkers sizes customelements history pointerevents postmessage webgl websockets cssanimations csscolumns csscolumns-width csscolumns-span csscolumns-fill csscolumns-gap csscolumns-rule csscolumns-rulecolor csscolumns-rulestyle csscolumns-rulewidth csscolumns-breakbefore csscolumns-breakafter csscolumns-breakinside flexbox picture srcset webworkers sizes customelements history pointerevents postmessage webgl websockets cssanimations csscolumns csscolumns-width csscolumns-span csscolumns-fill csscolumns-gap csscolumns-rule csscolumns-rulecolor csscolumns-rulestyle csscolumns-rulewidth csscolumns-breakbefore csscolumns-breakafter csscolumns-breakinside flexbox picture srcset webworkers sizes customelements history pointerevents postmessage webgl websockets cssanimations csscolumns csscolumns-width csscolumns-span csscolumns-fill csscolumns-gap csscolumns-rule csscolumns-rulecolor csscolumns-rulestyle csscolumns-rulewidth csscolumns-breakbefore csscolumns-breakafter csscolumns-breakinside flexbox picture srcset webworkers sizes customelements history pointerevents postmessage webgl websockets cssanimations csscolumns csscolumns-width csscolumns-span csscolumns-fill csscolumns-gap csscolumns-rule csscolumns-rulecolor csscolumns-rulestyle csscolumns-rulewidth csscolumns-breakbefore csscolumns-breakafter csscolumns-breakinside flexbox picture srcset webworkers sizes customelements history pointerevents postmessage webgl websockets cssanimations csscolumns csscolumns-width csscolumns-span csscolumns-fill csscolumns-gap csscolumns-rule csscolumns-rulecolor csscolumns-rulestyle csscolumns-rulewidth csscolumns-breakbefore csscolumns-breakafter csscolumns-breakinside flexbox picture srcset webworkers sizes customelements history pointerevents postmessage webgl websockets cssanimations csscolumns csscolumns-width csscolumns-span csscolumns-fill csscolumns-gap csscolumns-rule csscolumns-rulecolor csscolumns-rulestyle csscolumns-rulewidth csscolumns-breakbefore csscolumns-breakafter csscolumns-breakinside flexbox picture srcset webworkers sizes customelements history pointerevents postmessage webgl websockets cssanimations csscolumns csscolumns-width csscolumns-span csscolumns-fill csscolumns-gap csscolumns-rule csscolumns-rulecolor csscolumns-rulestyle csscolumns-rulewidth csscolumns-breakbefore csscolumns-breakafter csscolumns-breakinside flexbox picture srcset webworkers sizes customelements history pointerevents postmessage webgl websockets cssanimations csscolumns csscolumns-width csscolumns-span csscolumns-fill csscolumns-gap csscolumns-rule csscolumns-rulecolor csscolumns-rulestyle csscolumns-rulewidth csscolumns-breakbefore csscolumns-breakafter csscolumns-breakinside flexbox picture srcset webworkers">

<head>
    <!--====== Required meta tags ======-->
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">

    <meta name="author" content="Ayro UI">

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--====== Title ======-->
    <title>orgite</title>

    <!--====== Favicon Icon ======-->
    <link rel="shortcut icon" href="assets/images/favicon-16x16.png" type="image/png">

    <!--====== Bootstrap css ======-->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">

    <!--====== Line Icons css ======-->
    <link rel="stylesheet" href="assets/css/LineIcons.css">

    <!--====== Default css ======-->
    <link rel="stylesheet" href="assets/css/default.css">

    <!--====== Style css ======-->
    <link rel="stylesheet" href="assets/css/style.css">


</head>
</body>

</html>

<head>
    <!--====== Required meta tags ======-->
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">

    <meta name="author" content="Ayro UI">

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--====== Title ======-->
    <title>Orgivit</title>

    <!--====== Favicon Icon ======-->
    <link rel="shortcut icon" href="assets/images/favicon-16x16.png" type="image/png">

    <!--====== Bootstrap css ======-->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">

    <!--====== Line Icons css ======-->
    <link rel="stylesheet" href="assets/css/LineIcons.css">

    <!--====== Default css ======-->
    <link rel="stylesheet" href="assets/css/default.css">

    <!--====== Style css ======-->
    <link rel="stylesheet" href="assets/css/style.css">
    <style type="text/css">
        /* Copyright 2014-present Evernote Corporation. All rights reserved. */
        
        @keyframes caretBlink {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }
        
        @keyframes rotateSpinner {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        
        #text-tool-caret {
            animation-name: caretBlink;
            animation-iteration-count: infinite;
            animation-timing-function: cubic-bezier(1, 0, 0, 1);
            animation-duration: 1s;
        }
        
        #en-markup-loading-spinner {
            position: absolute;
            top: calc(50% - 16px);
            left: calc(50% - 16px);
            width: 32px;
            height: 32px;
        }
        
        #en-markup-loading-spinner img {
            position: relative;
            top: 0px;
            left: 0px;
            animation-name: rotateSpinner;
            animation-duration: 0.6s;
            animation-iteration-count: infinite;
            animation-timing-function: linear;
        }
    </style>
</head>


<section style="padding-top: 20px;" class="signin-area signin-one " id="signup">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-5">
                <form id="data-form" action="#">
                    <div class="signin-form form-style-two rounded-buttons">
                        <div class="col-md-12">
                            <label style="font-size: 30px; text-align: center;">Pharmacy Discount</label>
                        </div>


                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-input mt-15">
                                    <label>Date</label>
                                    <div class="input-items default">
                                        <input name="purchase_date" type="date" placeholder="" required="">
                                    </div>
                                </div>
                            </div>
                        <div class="col-md-12">
                            <div class="form-input mt-15">
                                <label>Card Number</label>
                                <div class="input-items default">
                                    <input oninput="cardFetch(event)" name="card_number" type="text" placeholder="" required>
                                </div>
                            </div>
                            <div class="form-input mt-15">
                                <label>Patient Name</label>
                                <div id="name-field" class="input-items default">
                                    <input name="name" type="text" required="">
                                    <i class="lni-user"></i>
                                </div>
                            </div>
                        </div>
                            <div class="col-md-12">
                                <div class="form-input mt-15">
                                    <label>Bill Amount (before discount) </label>
                                    <div class="input-items default">
                                        <input name="before_discount" type="text" placeholder="" >
                                    </div>
                                </div>
                                <div class="form-input mt-15">
                                    <label>Discount</label>
                                    <div class="input-items default">
                                        <input name="discount" type="text" placeholder="" required>
                                    </div>
                                </div>
                                <div class="form-input mt-15">
                                    <label>Net Bill (after discount) </label>
                                    <div class="input-items default">
                                        <input name="net_bill" type="text" placeholder="" required>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-12">
                                <div class="form-input mt-15">
                                    <label>Photo of Discount Receipt</label>
                                    <div class="input-items default">
                                        <input required="" oninput="handleImageUpload" id="file1" name="file1" type="file" accept="image/*" capture="camera" style="padding: 5px;">
                                        <i class="lni-paperclip"></i>
                                    </div>
                                </div>
                            </div>
                            </div> 
                            <div class="col-md-2"></div>
                            <div class="col-md-8">
                                <div class="form-input mt-20">
                                    <button class="main-btn rounded-two" type="submit">
                        Submit
                      </button>
                                </div>
                            </div>
                            <div class="col-md-12"></div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/browser-image-compression@latest/dist/browser-image-compression.js"></script>

<script>
    const toBase64 = file =>
        new Promise((resolve, reject) => {
            console.log('file: ', file)
            const reader = new FileReader()
            reader.readAsDataURL(file)
            reader.onload = () => resolve(reader.result)
            reader.onerror = error => resolve(false)
        })

        const compressImage = async (imageFile) => {
            console.log('originalFile instanceof Blob', imageFile instanceof Blob); // true
            console.log(`originalFile size ${imageFile.size / 1024 / 1024} MB`);
            
            const options = {
                maxSizeMB: 1,
                maxWidthOrHeight: 1920,
                useWebWorker: true
            }
            try {
                const compressedFile = await imageCompression(imageFile, options);
                console.log('compressedFile instanceof Blob', compressedFile instanceof Blob); // true
                console.log(`compressedFile size ${compressedFile.size / 1024 / 1024} MB`); // smaller than maxSizeMB
                return compressedFile
                await uploadToServer(compressedFile); // write your own logic
            } catch (error) {
                return error
            }

        }

        handleImageUpload  =  async (e) => {
            console.log('e: ', e);
            const a= Date.now()
            const body = new FormData(document.getElementById('data-form'))
            const compressedImage = await compressImage(body.get('file1'))
            window.compressedBase64 = await toBase64(compressedImage)
            const b = (Date.now()-a)/1000
            document.getElementById("time-test").innerText = b + 's'
            console.log("time taken", b)
        }
     const scriptURL =
        'https://script.google.com/macros/s/AKfycby6kTK3jKiPIUYN8ePaDEnMKkShKYVMvNu3NLDVTw/exec'
    const form = document.getElementById('data-form')
    form.elements.namedItem('purchase_date').value = new Date().toISOString().slice(0,10);

    form.addEventListener('submit', async e => {
        e.preventDefault()
        const body = new FormData(document.getElementById('data-form'))

        const body = new FormData(document.getElementById('data-form'))
        body.set('file1', window.compressedBase64)
        console.log('body: ', body)

        document.getElementById("submit-button").style.display="none"
        document.getElementById("spinner").style.display="block"
            
        fetch(scriptURL, {
                method: 'POST',
                body
            })
            .then(response => {
                window.compressedBase64 = undefined
                console.log('response: ', response);
                document.getElementById('data-form').reset()
                document.getElementById("submit-button").style.display="block"
                document.getElementById("spinner").style.display="none"
                alert('Successful')
            })
            .catch(error => {
                alert("Couldn't process your request, try again.")
                console.error('Error!', error.message)
            })
    })
    const cardFetch = async (e) => {
        const  cardNumber  = e.target.value
        if (cardNumber.length > 11) {
            const {data} = await fetch(`https://script.google.com/macros/s/AKfycbySLLbbHWhL91Wj1_W-5WtQSfHWB_LtDXu8D9cZrwQ5Sgkvf5iH/exec?card_number=${cardNumber}`).then(x => x.json())
            const [cardInfo] = data
            if(cardInfo){
                const formData = new FormData(form)
                console.log('body: ', Object.fromEntries(formData));
                console.log('cardInfo: ', cardInfo);
                Object.keys(cardInfo).map(key => {
                    if(formData.has(key)){
                        form.elements.namedItem(key).value = cardInfo[key]
                    }
                })
                console.log('formData: ', Object.fromEntries(formData));
                
                const nameList = [cardInfo.name, ...cardInfo.nominee_name.split(',').filter(x=>x)].map(x => x.toUpperCase())
                console.log('nameList: ', nameList);

                document.getElementById("name-field").innerHTML =   nameList.reduce((acc, nextItem,index) => acc + `<option value="${nextItem}">${nextItem}</option>`  ,`<select id="name" name="name" style="
                                        padding: 10px;
                                        padding-left: 50px;
                                        padding-right: 50px;
                                        font-size: 20px;
                                        ">`) + `</select>`

            }
        }
    }
</script>
</body>


</html>